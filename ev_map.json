{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#dbeeff",
  "width": 1200,
  "height": 650,
  "title": "EV Charging Stations â€” Ports (size) & Avg Sessions/Day (color)",
  "projection": { "type": "equalEarth" },
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/phuayy/FIT3179_Homework_W9/refs/heads/main/output.json",
        "format": { "type": "topojson", "feature": "ne_110m_graticules_1" }
      },
      "mark": {
        "type": "geoshape",
        "fill": null,
        "stroke": "#9ca3af",
        "strokeWidth": 0.6,
        "strokeOpacity": 0.55,
        "strokeCap": "round"
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/phuayy/FIT3179_Homework_W9/refs/heads/main/output.json",
        "format": { "type": "topojson", "feature": "my" }
      },
      "mark": { "type": "geoshape", "fill": "#f3f4f6", "stroke": "white" }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/phuayy/FIT3179_Homework_W9/refs/heads/main/ocm_ports_usage_bumped.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        {
          "calculate": "toNumber(replace(replace(datum.Longitude, /,/g, ''), /\\s+/g, ''))",
          "as": "lon"
        },
        {
          "calculate": "toNumber(replace(replace(datum.Latitude, /,/g, ''), /\\s+/g, ''))",
          "as": "lat"
        },
        {
          "calculate": "toNumber(replace(replace(datum.ports_inferred, /,/g, ''), /\\s+/g, ''))",
          "as": "ports"
        },
        {
          "calculate": "toNumber(replace(replace(datum.avg_sessions_per_day_site, /,/g, ''), /\\s+/g, ''))",
          "as": "avg_sessions"
        },
        { "filter": "!isNaN(datum.lon) && !isNaN(datum.lat)" },
        {
          "calculate": "datum.is_fast_dc == 1 ? 'DC fast' : 'AC'",
          "as": "charger_type"
        }
      ],
      "mark": { "type": "circle", "opacity": 0.85, "stroke": "white", "strokeWidth": 0.6 },
      "encoding": {
        "longitude": { "field": "lon", "type": "quantitative" },
        "latitude": { "field": "lat", "type": "quantitative" },
        "size": {
          "field": "ports",
          "type": "quantitative",
          "title": "Number of ports",
          "legend": { "format": ".0f" },
          "scale": { "range": [6, 220] }
        },
        "color": {
          "field": "avg_sessions",
          "type": "quantitative",
          "title": "Avg sessions/day",
          "legend": { "format": ".1f" },
          "scale": { "scheme": "teals" }
        },
        "tooltip": [
          { "field": "LocationTitle", "title": "Station" },
          { "field": "AddressLine1", "title": "Address" },
          { "field": "Town", "title": "Town" },
          { "field": "StateOrProvince", "title": "State" },
          { "field": "Postcode", "title": "Postcode" },
          { "field": "avg_sessions", "title": "Avg sessions/day", "type": "quantitative", "format": ".2f" },
          { "field": "ports", "title": "Ports", "type": "quantitative", "format": ".0f" },
          { "field": "lat", "title": "Latitude", "type": "quantitative", "format": ".5f" },
          { "field": "lon", "title": "Longitude", "type": "quantitative", "format": ".5f" }
        ]
      }
    }
  ]
}
